function e(t,s){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e(t,s)}var t;!function(e){e.AskForDefaults="ask_for_defaults",e.SDKHandshake="sdk_handshake",e.SDKHandshakeConfirmation="sdk_handshake_confirmation",e.CallbackEvent="callback_event",e.GetAssetList="get_assets_list",e.GetActiveAssets="get_active_assets",e.SetAvailableAssets="set_assets_list",e.SetActiveAsset="set_active_asset",e.GetBodyList="get_bodies_list",e.GetActiveBody="get_avatar_info",e.SetAvailableBodies="set_bodies_list",e.SetActiveBody="set_active_body",e.GetAnimationList="get_animation_list",e.GetActiveAnimation="get_animation_info",e.SetActiveAnimation="set_active_animation",e.ExportAvatar="export_avatar",e.GenerateThumbnail="generate_thumbnail",e.SetParam="set_param",e.SetHairColor="set_hair_color",e.SetEyewearColor="set_eyewear_color",e.SetBodyProportions="set_body_proportions",e.SetSkinTone="set_skin_tone",e.GetHairColor="get_hair_color",e.GetEyewearColor="get_eyewear_color",e.GetBodyProportions="get_body_proportions",e.GetSkinTone="get_skin_tone"}(t||(t={}));var s=/*#__PURE__*/function(){function e(){this.listeners={}}var t=e.prototype;return t.watch=function(e,t){this.listeners[e]=t},t.unwatch=function(e){delete this.listeners[e]},e}(),r=/*#__PURE__*/function(){function e(e,t){this.handshakeData={},this.recipient=void 0,this.thisSourceName="v1.avaturn-sdk",this.expectedIncomingSourceName="v1.avaturn-sdk-server",this._queue=new s,this._messageHandler=this.messageHandler.bind(this),e&&(this.thisSourceName=e),t&&(this.expectedIncomingSourceName=t)}var r=e.prototype;return r.sendMessage=function(e,t,s,r){var n=this;return void 0===r&&(r=!0),new Promise(function(i,o){var a,c=Date.now(),u=s||e+c;r&&n._queue.watch(u,function(e,t){var s=null!=t?t:null;e?i(s):o(s),n._queue.unwatch(u)}),null==(a=n.recipient)||a.postMessage({type:"MESSAGE",source:n.thisSourceName,eventName:e,key:u,date:c,data:t,isOk:!0},"*"),r||i(null)})},r.messageHandler=function(e){var s=e.data;this.expectedIncomingSourceName==s.source&&("RESPONSE"===s.type&&("sdk_handshake"===s.key&&this.sendMessage(t.SDKHandshakeConfirmation,this.handshakeData,void 0,!1),this._queue.listeners[s.key]&&this._queue.listeners[s.key](s.isOk,s.data)),"MESSAGE"===s.type&&this.handleMessage(s))},r.setupMessaging=function(){window.addEventListener("message",this._messageHandler)},r.destroyMessaging=function(){console.log("destroy"),window.removeEventListener("message",this._messageHandler)},r.sendResponse=function(e,t,s){var r,n=void 0===s?{isOk:!0}:s,i=n.isOk,o=n.data;if(this.recipient){var a={type:"RESPONSE",source:this.thisSourceName,eventName:e,key:t,date:Date.now(),data:o,isOk:i};null==(r=this.recipient)||r.postMessage(a,"*")}else console.log("Recipient is not set.")},r.handleMessage=function(e){},e}(),n=/*#__PURE__*/function(s){var r,n;function i(){var e;return(e=s.call(this)||this)._version="1.0.0",e.defaultAssets=void 0,e.sceneRef=null,e.callbacks={},e.suppressCallbacks=void 0,e}n=s,(r=i).prototype=Object.create(n.prototype),r.prototype.constructor=r,e(r,n);var o=i.prototype;return o.applyStyles=function(e){e.style.width="100%",e.style.height="100%"},o.setupDOM=function(e,t,s){var r,n=document.querySelector("#avaturn-sdk-iframe");n&&n.remove();var i=document.createElement("iframe");i.setAttribute("src",t),i.setAttribute("id","avaturn-sdk-iframe"),i.setAttribute("allow","camera *; clipboard-write"),i.setAttribute("allowfullscreen",""),i.setAttribute("frameborder","0"),s?i.setAttribute("class",s):this.applyStyles(i),e.appendChild(i),this.sceneRef=document.querySelector("#avaturn-sdk-iframe"),this.recipient=null==(r=this.sceneRef)?void 0:r.contentWindow},o.handleMessage=function(e){var s,r;switch(e.eventName){case t.AskForDefaults:this.sendResponse(t.AskForDefaults,e.key,{isOk:!0,data:this.defaultAssets});break;case t.CallbackEvent:null==(s=(r=this.callbacks)[e.key])||s.call(r,e.data)}},o.init=function(e,s){var r=s.url,n=s.iframeClassName,i=s.disableUi,o=s.defaultAssets;try{var a=this;a.suppressCallbacks=i,a.defaultAssets=o;var c=new URL(r||"https://preview.avaturn.dev/editor?avatar_link=https%3A%2F%2Fassets.avaturn.me%2Feditor_resources%2Fdefault_male.glb");return c.searchParams.append("sdk","true"),i&&c.searchParams.append("noui","true"),e?a.setupDOM(e,c.toString(),n):a.recipient=window,a.handshakeData={url:document.location.href,environment:window.avaturnSDKEnvironment,version:a._version},a.setupMessaging(),Promise.resolve(a.sendMessage(t.SDKHandshake,a.handshakeData,"sdk_handshake").then(function(){try{return Promise.resolve(a.sendMessage(t.SDKHandshakeConfirmation,a.handshakeData,void 0,!1)).then(function(){return a})}catch(e){return Promise.reject(e)}}).catch(function(e){throw new Error(e)}))}catch(e){return Promise.reject(e)}},o.destroy=function(){this.destroyMessaging(),this.callbacks={}},o.on=function(e,t){return this.suppressCallbacks&&"load"!=e?(console.log("Can't use callbacks for "+e+" in disableUi mode. Use <action>.then(...) instead."),this):(this.callbacks[e]=t,this)},o.getAssetList=function(){try{return Promise.resolve(this.sendMessage(t.GetAssetList))}catch(e){return Promise.reject(e)}},o.setAvailableAssets=function(e){try{return Promise.resolve(this.sendMessage(t.SetAvailableAssets,e))}catch(e){return Promise.reject(e)}},o.getActiveAssets=function(){try{return Promise.resolve(this.sendMessage(t.GetActiveAssets))}catch(e){return Promise.reject(e)}},o.setActiveAsset=function(e){try{return Promise.resolve(this.sendMessage(t.SetActiveAsset,e))}catch(e){return Promise.reject(e)}},o.setActiveBody=function(e){try{return Promise.resolve(this.sendMessage(t.SetActiveBody,e))}catch(e){return Promise.reject(e)}},o.getBodyList=function(){try{return Promise.resolve(this.sendMessage(t.GetBodyList))}catch(e){return Promise.reject(e)}},o.getActiveBody=function(){try{return Promise.resolve(this.sendMessage(t.GetActiveBody))}catch(e){return Promise.reject(e)}},o.setActiveAnimation=function(e){try{return Promise.resolve(this.sendMessage(t.SetActiveAnimation,e))}catch(e){return Promise.reject(e)}},o.getActiveAnimation=function(){try{return Promise.resolve(this.sendMessage(t.GetActiveAnimation))}catch(e){return Promise.reject(e)}},o.getAnimationList=function(){try{return Promise.resolve(this.sendMessage(t.GetAnimationList))}catch(e){return Promise.reject(e)}},o.exportAvatar=function(){try{return Promise.resolve(this.sendMessage(t.ExportAvatar,void 0,"export_avatar"))}catch(e){return Promise.reject(e)}},o.setHairColor=function(e){try{return Promise.resolve(this.sendMessage(t.SetHairColor,e))}catch(e){return Promise.reject(e)}},o.setEyewearColor=function(e){try{return Promise.resolve(this.sendMessage(t.SetEyewearColor,e))}catch(e){return Promise.reject(e)}},o.setBodyProportions=function(e,s){try{return Promise.resolve(this.sendMessage(t.SetBodyProportions,{key:e,value:s}))}catch(e){return Promise.reject(e)}},o.setSkinToneCorrection=function(e){try{return Promise.resolve(this.sendMessage(t.SetSkinTone,e))}catch(e){return Promise.reject(e)}},o.getHairColor=function(){try{return Promise.resolve(this.sendMessage(t.GetHairColor))}catch(e){return Promise.reject(e)}},o.getEyewearColor=function(){try{return Promise.resolve(this.sendMessage(t.GetEyewearColor))}catch(e){return Promise.reject(e)}},o.getBodyProportions=function(){try{return Promise.resolve(this.sendMessage(t.GetBodyProportions))}catch(e){return Promise.reject(e)}},o.getSkinToneCorrection=function(){try{return Promise.resolve(this.sendMessage(t.GetSkinTone))}catch(e){return Promise.reject(e)}},i}(r);export{n as AvaturnSDK,t as MessageType,r as Messaging};
